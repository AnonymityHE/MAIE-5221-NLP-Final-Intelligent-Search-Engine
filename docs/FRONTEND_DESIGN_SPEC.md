# MiniMango å‰ç«¯äº¤äº’è®¾è®¡è§„èŒƒ

> **é¢å‘å‰ç«¯å¼€å‘è€…çš„å®Œæ•´APIå’Œäº¤äº’è®¾è®¡æ–‡æ¡£**  
> ç‰ˆæœ¬ï¼šv1.0.0 | æ›´æ–°æ—¥æœŸï¼š2025-11-17

---

## ğŸ“‹ ç›®å½•

1. [è®¾è®¡ç†å¿µ](#è®¾è®¡ç†å¿µ)
2. [æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ](#æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ)
3. [äº¤äº’æ–¹å¼](#äº¤äº’æ–¹å¼)
4. [APIæ¥å£è§„èŒƒ](#apiæ¥å£è§„èŒƒ)
5. [æ•°æ®æ ¼å¼å®šä¹‰](#æ•°æ®æ ¼å¼å®šä¹‰)
6. [UI/UXè®¾è®¡æŒ‡å—](#uiuxè®¾è®¡æŒ‡å—)
7. [äº¤äº’æµç¨‹å›¾](#äº¤äº’æµç¨‹å›¾)
8. [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
9. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)

---

## ğŸ¨ è®¾è®¡ç†å¿µ

### æ ¸å¿ƒåŸåˆ™

- **æç®€ä¸»ä¹‰**ï¼šç±»ä¼¼Siriçš„ç®€æ´äº¤äº’ç•Œé¢
- **æ™ºèƒ½å“åº”**ï¼šè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·æ„å›¾ï¼Œæ— éœ€æ‰‹åŠ¨é€‰æ‹©å·¥å…·
- **å¤šæ¨¡æ€**ï¼šæ— ç¼åˆ‡æ¢æ–‡æœ¬ã€è¯­éŸ³äº¤äº’
- **å®æ—¶åé¦ˆ**ï¼šæµå¼è¾“å‡ºï¼Œå³æ—¶æ˜¾ç¤ºå¤„ç†çŠ¶æ€
- **å¤šè¯­è¨€**ï¼šåŸç”Ÿæ”¯æŒç²¤è¯­ã€æ™®é€šè¯ã€è‹±è¯­

### è®¾è®¡é£æ ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚         ğŸ¤– MiniMango                â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚                         â”‚    â”‚
â”‚    â”‚   ä½ å¥½ï¼æˆ‘èƒ½å¸®ä½ ä»€ä¹ˆï¼Ÿ    â”‚    â”‚
â”‚    â”‚                         â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚
â”‚    [æ–‡æœ¬è¾“å…¥æ¡†æˆ–è¯­éŸ³æŒ‰é’®]           â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ

### 1. æ™ºèƒ½é—®ç­”
- **æœ¬åœ°çŸ¥è¯†åº“æ£€ç´¢**ï¼š175+çŸ¥è¯†å—ï¼Œæ¶µç›–ç³»ç»Ÿæ–‡æ¡£ã€FAQã€æŠ€æœ¯ç»†èŠ‚
- **å®æ—¶ç½‘é¡µæœç´¢**ï¼šè·å–æœ€æ–°ä¿¡æ¯
- **å¤šè½®å¯¹è¯**ï¼šæ”¯æŒä¸Šä¸‹æ–‡ç†è§£ï¼ˆéœ€å‰ç«¯ç®¡ç†å¯¹è¯å†å²ï¼‰

### 2. å®æ—¶ä¿¡æ¯æŸ¥è¯¢
- **å¤©æ°”æŸ¥è¯¢**ï¼šæ”¯æŒå…¨çƒä¸»è¦åŸå¸‚
- **è‚¡ç¥¨æŸ¥è¯¢**ï¼šå®æ—¶è‚¡ä»·ã€æ¶¨è·Œå¹…
- **äº¤é€šè·¯çº¿**ï¼šæ—…è¡Œæ—¶é—´å’Œè·¯çº¿è§„åˆ’

### 3. å¤šæ¨¡æ€äº¤äº’
- **æ–‡æœ¬è¾“å…¥**ï¼šæ”¯æŒå¤šè¯­è¨€æ··åˆè¾“å…¥
- **è¯­éŸ³è¾“å…¥**ï¼šWhisper + ç²¤è¯­ä¸“ç”¨API
- **è¯­éŸ³è¾“å‡º**ï¼šè‡ªç„¶æµç•…çš„TTSï¼ˆæ”¯æŒç²¤è¯­ã€æ™®é€šè¯ã€è‹±è¯­ï¼‰

### 4. æ™ºèƒ½å·¥ä½œæµ
- **è‡ªåŠ¨å·¥å…·é€‰æ‹©**ï¼šç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­éœ€è¦å“ªäº›å·¥å…·
- **å¤šæ­¥éª¤ä»»åŠ¡**ï¼šå¤æ‚æŸ¥è¯¢è‡ªåŠ¨åˆ†è§£æ‰§è¡Œ
- **ç»“æœç»¼åˆ**ï¼šæ•´åˆå¤šä¸ªæ•°æ®æºçš„ä¿¡æ¯

---

## ğŸ”„ äº¤äº’æ–¹å¼

### æ–¹å¼ä¸€ï¼šæ–‡æœ¬äº¤äº’ï¼ˆREST APIï¼‰

**æ¨èåœºæ™¯**ï¼šæ¡Œé¢ç«¯ã€ç§»åŠ¨ç«¯æ–‡æœ¬è¾“å…¥

```javascript
// å‘é€æ–‡æœ¬æŸ¥è¯¢
POST /api/agent_query
Content-Type: application/json

{
  "query": "é¦™æ¸¯ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
  "provider": "hkgai",  // å¯é€‰ï¼šhkgaiï¼ˆé»˜è®¤ï¼‰æˆ– gemini
  "model": "HKGAI-V1"   // å¯é€‰ï¼šæŒ‡å®šæ¨¡å‹
}

// å“åº”
{
  "answer": "é¦™æ¸¯ä»Šå¤©çš„å¤©æ°”æ˜¯å¤šäº‘ï¼Œæ¸©åº¦ä¸º25Â°C...",
  "tools_used": ["weather"],
  "contexts_count": 3,
  "has_context": true,
  "model": "HKGAI-V1",
  "tokens": {
    "input": 150,
    "output": 200,
    "total": 350
  },
  "workflow_engine": "llm_driven",
  "response_time": 12.5
}
```

### æ–¹å¼äºŒï¼šè¯­éŸ³äº¤äº’ï¼ˆWebSocketï¼‰

**æ¨èåœºæ™¯**ï¼šç§»åŠ¨ç«¯ã€æ™ºèƒ½åŠ©æ‰‹æ¨¡å¼

```javascript
// 1. å»ºç«‹WebSocketè¿æ¥
const ws = new WebSocket('ws://localhost:8000/ws/voice');

// 2. å‘é€éŸ³é¢‘æµï¼ˆå®æ—¶ï¼‰
ws.send(audioChunk);  // Int16Array æˆ– Float32Array

// 3. æ¥æ”¶è½¬å½•å’Œå›ç­”
ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  
  if (data.type === 'transcription') {
    // æ˜¾ç¤ºè½¬å½•æ–‡æœ¬
    console.log('ä½ è¯´ï¼š', data.text);
  }
  
  if (data.type === 'answer') {
    // æ˜¾ç¤ºå›ç­”
    console.log('åŠ©æ‰‹ï¼š', data.answer);
  }
  
  if (data.type === 'audio') {
    // æ’­æ”¾è¯­éŸ³å›å¤ï¼ˆBase64ç¼–ç çš„éŸ³é¢‘ï¼‰
    playAudio(data.audio);
  }
};
```

### æ–¹å¼ä¸‰ï¼šæ··åˆäº¤äº’ï¼ˆæ¨èï¼‰

æ”¯æŒç”¨æˆ·åœ¨æ–‡æœ¬å’Œè¯­éŸ³é—´è‡ªç”±åˆ‡æ¢ï¼š

```javascript
// æ–‡æœ¬è¾“å…¥æ—¶ä½¿ç”¨REST API
async function sendTextQuery(text) {
  const response = await fetch('/api/agent_query', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ query: text })
  });
  return await response.json();
}

// è¯­éŸ³è¾“å…¥æ—¶åˆ‡æ¢åˆ°WebSocket
function startVoiceMode() {
  ws = new WebSocket('ws://localhost:8000/ws/voice');
  // ... WebSocketé€»è¾‘
}
```

---

## ğŸ“¡ APIæ¥å£è§„èŒƒ

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:8000` (å¼€å‘ç¯å¢ƒ)
- **ç”Ÿäº§ç¯å¢ƒ**: `https://your-domain.com`
- **APIç‰ˆæœ¬**: v1
- **è®¤è¯æ–¹å¼**: æš‚æ— ï¼ˆå¯æ ¹æ®éœ€æ±‚æ·»åŠ JWTï¼‰

---

### 1. æ™ºèƒ½é—®ç­”æ¥å£

#### 1.1 AgentæŸ¥è¯¢ï¼ˆæ¨èä½¿ç”¨ï¼‰

**ç«¯ç‚¹**: `POST /api/agent_query`

**åŠŸèƒ½**: æ™ºèƒ½è¯†åˆ«ç”¨æˆ·æ„å›¾ï¼Œè‡ªåŠ¨é€‰æ‹©åˆé€‚å·¥å…·ï¼Œè¿”å›ç»¼åˆç­”æ¡ˆ

**è¯·æ±‚ä½“**:
```json
{
  "query": "string (å¿…éœ€)",           // ç”¨æˆ·é—®é¢˜
  "provider": "string (å¯é€‰)",         // LLMæä¾›å•†ï¼šhkgai/geminiï¼Œé»˜è®¤hkgai
  "model": "string (å¯é€‰)",           // æ¨¡å‹åç§°ï¼Œé»˜è®¤HKGAI-V1
  "conversation_id": "string (å¯é€‰)"  // å¯¹è¯IDï¼ˆç”¨äºå¤šè½®å¯¹è¯ï¼‰
}
```

**å“åº”**:
```json
{
  "answer": "string",              // æœ€ç»ˆç­”æ¡ˆ
  "tools_used": ["string"],        // ä½¿ç”¨çš„å·¥å…·åˆ—è¡¨
  "contexts_count": 0,             // æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡æ•°é‡
  "has_context": false,            // æ˜¯å¦ä½¿ç”¨äº†çŸ¥è¯†åº“
  "model": "string",               // ä½¿ç”¨çš„æ¨¡å‹
  "tokens": {                      // Tokenä½¿ç”¨æƒ…å†µ
    "input": 0,
    "output": 0,
    "total": 0
  },
  "workflow_engine": "string",     // å·¥ä½œæµå¼•æ“ï¼šllm_driven/rule_based/single_tool
  "workflow_type": "string",       // å·¥ä½œæµç±»å‹
  "workflow_confidence": 0.95,     // å·¥ä½œæµè§„åˆ’ç½®ä¿¡åº¦
  "response_time": 12.5            // å“åº”æ—¶é—´ï¼ˆç§’ï¼‰
}
```

**ç¤ºä¾‹**:
```bash
# å¤©æ°”æŸ¥è¯¢
curl -X POST "http://localhost:8000/api/agent_query" \
  -H "Content-Type: application/json" \
  -d '{"query": "é¦™æ¸¯ä»Šå¤©å¤©æ°”"}'

# è‚¡ç¥¨æŸ¥è¯¢
curl -X POST "http://localhost:8000/api/agent_query" \
  -H "Content-Type: application/json" \
  -d '{"query": "è‹¹æœå…¬å¸çš„è‚¡ä»·"}'

# çŸ¥è¯†åº“æŸ¥è¯¢
curl -X POST "http://localhost:8000/api/agent_query" \
  -H "Content-Type: application/json" \
  -d '{"query": "å¦‚ä½•ä½¿ç”¨ç²¤è¯­è¾“å…¥ï¼Ÿ"}'

# å¤æ‚æŸ¥è¯¢ï¼ˆè§¦å‘å·¥ä½œæµï¼‰
curl -X POST "http://localhost:8000/api/agent_query" \
  -H "Content-Type: application/json" \
  -d '{"query": "å¯¹æ¯”NVIDIAå’ŒAMDçš„è‚¡ä»·"}'
```

---

#### 1.2 RAGæŸ¥è¯¢ï¼ˆä»…çŸ¥è¯†åº“ï¼‰

**ç«¯ç‚¹**: `POST /api/rag_query`

**åŠŸèƒ½**: ä»…ä»æœ¬åœ°çŸ¥è¯†åº“æ£€ç´¢ï¼Œä¸ä½¿ç”¨å¤–éƒ¨å·¥å…·

**è¯·æ±‚ä½“**:
```json
{
  "query": "string (å¿…éœ€)",
  "top_k": 5,                     // å¯é€‰ï¼šæ£€ç´¢æ•°é‡ï¼Œé»˜è®¤5
  "provider": "hkgai",             // å¯é€‰ï¼šLLMæä¾›å•†
  "file_ids": ["string"]           // å¯é€‰ï¼šæŒ‡å®šæ–‡ä»¶ID
}
```

**å“åº”**:
```json
{
  "answer": "string",
  "context": ["string"],           // æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡
  "query": "string",
  "model_used": "string",
  "tokens_used": {},
  "answer_source": "rag"
}
```

---

### 2. è¯­éŸ³äº¤äº’æ¥å£

#### 2.1 WebSocketå®æ—¶è¯­éŸ³

**ç«¯ç‚¹**: `ws://localhost:8000/ws/voice`

**åè®®**: WebSocket

**è¿æ¥å‚æ•°**:
```javascript
const ws = new WebSocket('ws://localhost:8000/ws/voice');
```

**å®¢æˆ·ç«¯å‘é€ï¼ˆéŸ³é¢‘æµï¼‰**:
```javascript
// éŸ³é¢‘æ ¼å¼ï¼š16kHz, 16-bit, Mono, PCM
const audioData = new Int16Array(sampleBuffer);
ws.send(audioData.buffer);
```

**æœåŠ¡ç«¯æ¶ˆæ¯ç±»å‹**:

1. **è¿æ¥ç¡®è®¤**:
```json
{
  "type": "connected",
  "message": "WebSocketè¿æ¥æˆåŠŸ",
  "session_id": "uuid"
}
```

2. **è½¬å½•ç»“æœ**:
```json
{
  "type": "transcription",
  "text": "ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
  "language": "zh",
  "confidence": 0.95
}
```

3. **å¤„ç†çŠ¶æ€**:
```json
{
  "type": "status",
  "status": "processing",        // processing/completed/error
  "message": "æ­£åœ¨æŸ¥è¯¢å¤©æ°”ä¿¡æ¯..."
}
```

4. **æ–‡æœ¬ç­”æ¡ˆ**:
```json
{
  "type": "answer",
  "answer": "é¦™æ¸¯ä»Šå¤©çš„å¤©æ°”æ˜¯...",
  "tools_used": ["weather"],
  "response_time": 3.5
}
```

5. **è¯­éŸ³å›å¤**:
```json
{
  "type": "audio",
  "audio": "base64_encoded_audio_data",
  "format": "mp3",
  "language": "zh-CN"
}
```

6. **é”™è¯¯ä¿¡æ¯**:
```json
{
  "type": "error",
  "error": "è¯­éŸ³è¯†åˆ«å¤±è´¥",
  "code": "STT_ERROR"
}
```

---

#### 2.2 æ–‡ä»¶ä¸Šä¼ è¯­éŸ³æŸ¥è¯¢

**ç«¯ç‚¹**: `POST /api/voice/query`

**åŠŸèƒ½**: ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶è¿›è¡ŒæŸ¥è¯¢ï¼ˆéå®æ—¶ï¼‰

**è¯·æ±‚**:
```javascript
const formData = new FormData();
formData.append('audio', audioBlob, 'query.wav');
formData.append('request', JSON.stringify({
  use_wake_word: false,
  use_agent: true,
  language: 'zh'  // å¯é€‰ï¼šzh/yue/en
}));

fetch('/api/voice/query', {
  method: 'POST',
  body: formData
});
```

**å“åº”**:
```json
{
  "transcription": {
    "text": "è½¬å½•æ–‡æœ¬",
    "language": "zh",
    "confidence": 0.95
  },
  "answer": "å›ç­”å†…å®¹",
  "tools_used": ["tool1"],
  "audio_response": "base64_audio_data"
}
```

---

### 3. æ–‡ä»¶ç®¡ç†æ¥å£

#### 3.1 ä¸Šä¼ æ–‡ä»¶

**ç«¯ç‚¹**: `POST /api/upload`

**åŠŸèƒ½**: ä¸Šä¼ PDFã€å›¾ç‰‡ã€ä»£ç ç­‰æ–‡ä»¶åˆ°çŸ¥è¯†åº“

**è¯·æ±‚**:
```javascript
const formData = new FormData();
formData.append('file', fileBlob, 'document.pdf');

fetch('/api/upload', {
  method: 'POST',
  body: formData
});
```

**å“åº”**:
```json
{
  "file_id": "uuid",
  "filename": "document.pdf",
  "file_type": "pdf",
  "file_size": 1024000,
  "uploaded_at": "2025-11-17T10:00:00",
  "processed": false,
  "message": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œæ­£åœ¨åå°å¤„ç†..."
}
```

#### 3.2 åˆ—å‡ºæ–‡ä»¶

**ç«¯ç‚¹**: `GET /api/files`

**æŸ¥è¯¢å‚æ•°**:
- `file_type`: æŒ‰ç±»å‹ç­›é€‰ï¼ˆpdf/image/code/textï¼‰
- `processed`: æ˜¯å¦å·²å¤„ç†ï¼ˆtrue/falseï¼‰
- `limit`: è¿”å›æ•°é‡ï¼ˆé»˜è®¤50ï¼‰

**å“åº”**:
```json
{
  "files": [
    {
      "file_id": "uuid",
      "filename": "document.pdf",
      "file_type": "pdf",
      "file_size": 1024000,
      "uploaded_at": "2025-11-17T10:00:00",
      "processed": true,
      "chunk_count": 25
    }
  ],
  "total": 100,
  "page": 1
}
```

#### 3.3 åˆ é™¤æ–‡ä»¶

**ç«¯ç‚¹**: `DELETE /api/files/{file_id}`

**å“åº”**:
```json
{
  "message": "æ–‡ä»¶åˆ é™¤æˆåŠŸ",
  "file_id": "uuid"
}
```

---

### 4. ç³»ç»Ÿä¿¡æ¯æ¥å£

#### 4.1 å¥åº·æ£€æŸ¥

**ç«¯ç‚¹**: `GET /health`

**å“åº”**:
```json
{
  "status": "healthy",
  "services": {
    "milvus": "connected",
    "llm": "available",
    "speech": "available"
  },
  "version": "1.0.0"
}
```

#### 4.2 æ”¯æŒçš„æ¨¡å‹

**ç«¯ç‚¹**: `GET /api/models`

**å“åº”**:
```json
{
  "default_provider": "hkgai",
  "providers": ["hkgai", "gemini"],
  "hkgai_models": ["HKGAI-V1"],
  "gemini_models": [
    "gemini-2.0-flash",
    "gemini-2.5-flash",
    "gemini-2.5-pro"
  ]
}
```

#### 4.3 ç”¨é‡ç»Ÿè®¡

**ç«¯ç‚¹**: `GET /api/usage/stats`

**å“åº”**:
```json
{
  "date": "2025-11-17",
  "total_requests": 150,
  "total_tokens": 50000,
  "by_model": {
    "HKGAI-V1": {
      "requests": 100,
      "tokens": 30000
    },
    "gemini-2.0-flash": {
      "requests": 50,
      "tokens": 20000
    }
  }
}
```

---

## ğŸ“¦ æ•°æ®æ ¼å¼å®šä¹‰

### æŸ¥è¯¢å¯¹è±¡

```typescript
interface Query {
  query: string;                    // å¿…éœ€ï¼šç”¨æˆ·é—®é¢˜
  provider?: 'hkgai' | 'gemini';    // å¯é€‰ï¼šLLMæä¾›å•†
  model?: string;                   // å¯é€‰ï¼šæ¨¡å‹åç§°
  conversation_id?: string;         // å¯é€‰ï¼šå¯¹è¯ID
  file_ids?: string[];              // å¯é€‰ï¼šæŒ‡å®šæ–‡ä»¶
  top_k?: number;                   // å¯é€‰ï¼šæ£€ç´¢æ•°é‡
}
```

### å“åº”å¯¹è±¡

```typescript
interface Response {
  answer: string;                   // ç­”æ¡ˆæ–‡æœ¬
  tools_used: string[];             // ä½¿ç”¨çš„å·¥å…·
  contexts_count: number;           // ä¸Šä¸‹æ–‡æ•°é‡
  has_context: boolean;             // æ˜¯å¦ä½¿ç”¨çŸ¥è¯†åº“
  model: string;                    // ä½¿ç”¨çš„æ¨¡å‹
  tokens?: TokenUsage;              // Tokenä½¿ç”¨æƒ…å†µ
  workflow_engine?: string;         // å·¥ä½œæµå¼•æ“
  workflow_type?: string;           // å·¥ä½œæµç±»å‹
  workflow_confidence?: number;     // ç½®ä¿¡åº¦
  response_time: number;            // å“åº”æ—¶é—´
}

interface TokenUsage {
  input: number;
  output: number;
  total: number;
}
```

### è¯­éŸ³å¯¹è±¡

```typescript
interface VoiceTranscription {
  text: string;                     // è½¬å½•æ–‡æœ¬
  language: 'zh' | 'yue' | 'en';    // è¯†åˆ«è¯­è¨€
  confidence: number;               // ç½®ä¿¡åº¦ 0-1
}

interface VoiceResponse {
  transcription: VoiceTranscription;
  answer: string;                   // æ–‡æœ¬ç­”æ¡ˆ
  tools_used: string[];
  audio_response?: string;          // Base64éŸ³é¢‘
}
```

### æ–‡ä»¶å¯¹è±¡

```typescript
interface FileInfo {
  file_id: string;
  filename: string;
  file_type: 'pdf' | 'image' | 'code' | 'text';
  file_size: number;                // å­—èŠ‚
  uploaded_at: string;              // ISO 8601
  processed: boolean;
  chunk_count?: number;
}
```

---

## ğŸ¨ UI/UXè®¾è®¡æŒ‡å—

### ä¸»ç•Œé¢è®¾è®¡

#### å¸ƒå±€ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ¤– MiniMango                    â”‚ â”‚
â”‚  â”‚  ä½ çš„æ™ºèƒ½åŠ©æ‰‹                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚  Chat Container                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚  [å¯¹è¯æ°”æ³¡åŒºåŸŸ]                   â”‚ â”‚
â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ ç”¨æˆ·ï¼šé¦™æ¸¯ä»Šå¤©å¤©æ°”ï¼Ÿ        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ åŠ©æ‰‹ï¼šé¦™æ¸¯ä»Šå¤©å¤šäº‘ï¼Œ25Â°C... â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ ğŸŒ¤ï¸ æ¸©åº¦ï¼š25Â°C               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ ğŸ’¨ é£é€Ÿï¼š19km/h             â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚  Input Area                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  [æ–‡æœ¬è¾“å…¥æ¡†]          ğŸ¤  â¡ï¸    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### äº¤äº’çŠ¶æ€è®¾è®¡

#### 1. ç©ºé—²çŠ¶æ€ï¼ˆIdleï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                â”‚
â”‚        ğŸ¤– MiniMango            â”‚
â”‚                                â”‚
â”‚    ä½ å¥½ï¼æˆ‘èƒ½å¸®ä½ ä»€ä¹ˆï¼Ÿ         â”‚
â”‚                                â”‚
â”‚  ğŸ’¡ è¯•è¯•è¿™äº›ï¼š                 â”‚
â”‚  â€¢ "é¦™æ¸¯ä»Šå¤©å¤©æ°”"              â”‚
â”‚  â€¢ "è‹¹æœè‚¡ä»·"                  â”‚
â”‚  â€¢ "å¦‚ä½•ä¸Šä¼ æ–‡ä»¶"              â”‚
â”‚                                â”‚
â”‚  [          è¾“å…¥...      ğŸ¤ ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. è¾“å…¥çŠ¶æ€ï¼ˆTypingï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä½ ï¼šé¦™æ¸¯ä»Šå¤©å¤©æ°”|             â”‚
â”‚                                â”‚
â”‚  [  é¦™æ¸¯ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·  ğŸ¤ â¡ï¸]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. è¯­éŸ³è¾“å…¥çŠ¶æ€ï¼ˆListeningï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                â”‚
â”‚        ğŸ¤ æ­£åœ¨å¬...            â”‚
â”‚                                â”‚
â”‚     â—â—â—â—â—â—â—â—â—‹â—‹                â”‚
â”‚                                â”‚
â”‚      [ç‚¹å‡»åœæ­¢å½•éŸ³]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4. å¤„ç†çŠ¶æ€ï¼ˆProcessingï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä½ ï¼šé¦™æ¸¯ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·         â”‚
â”‚                                â”‚
â”‚  åŠ©æ‰‹ï¼š                        â”‚
â”‚  â³ æ­£åœ¨æŸ¥è¯¢å¤©æ°”ä¿¡æ¯...        â”‚
â”‚  ğŸ” ä½¿ç”¨å·¥å…·ï¼šweather          â”‚
â”‚                                â”‚
â”‚  [åŠ¨ç”»åŠ è½½æŒ‡ç¤ºå™¨]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5. å›ç­”çŠ¶æ€ï¼ˆAnsweringï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä½ ï¼šé¦™æ¸¯ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·         â”‚
â”‚                                â”‚
â”‚  åŠ©æ‰‹ï¼š                        â”‚
â”‚  é¦™æ¸¯ä»Šå¤©çš„å¤©æ°”æ˜¯å¤šäº‘ï¼Œ         â”‚
â”‚  æ¸©åº¦ä¸º25Â°Cï¼Œä½“æ„Ÿ27Â°Cã€‚        â”‚
â”‚                                â”‚
â”‚  ğŸŒ¤ï¸ å¤šäº‘                       â”‚
â”‚  ğŸŒ¡ï¸ 25Â°C (ä½“æ„Ÿ 27Â°C)           â”‚
â”‚  ğŸ’§ æ¹¿åº¦ 69%                    â”‚
â”‚  ğŸ’¨ é£é€Ÿ 19km/h ä¸œåŒ—            â”‚
â”‚                                â”‚
â”‚  ğŸ“Š ä½¿ç”¨å·¥å…·ï¼šweather           â”‚
â”‚  â±ï¸ å“åº”æ—¶é—´ï¼š3.2ç§’            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6. é”™è¯¯çŠ¶æ€ï¼ˆErrorï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä½ ï¼šæŸ¥è¯¢xyzè‚¡ç¥¨               â”‚
â”‚                                â”‚
â”‚  åŠ©æ‰‹ï¼š                        â”‚
â”‚  âš ï¸ æŠ±æ­‰ï¼Œæ— æ³•è¯†åˆ«è¯¥è‚¡ç¥¨ä»£ç    â”‚
â”‚                                â”‚
â”‚  ğŸ’¡ å»ºè®®ï¼š                     â”‚
â”‚  â€¢ æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®        â”‚
â”‚  â€¢ å°è¯•ä½¿ç”¨å…¬å¸å…¨å            â”‚
â”‚  â€¢ ä¾‹å¦‚ï¼š"è‹¹æœè‚¡ä»·"            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ¶ˆæ¯æ°”æ³¡è®¾è®¡

#### ç”¨æˆ·æ¶ˆæ¯

```css
.user-message {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 18px 18px 4px 18px;
  padding: 12px 16px;
  max-width: 70%;
  margin-left: auto;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}
```

#### åŠ©æ‰‹æ¶ˆæ¯

```css
.assistant-message {
  background: #f7f9fc;
  color: #2d3748;
  border-radius: 18px 18px 18px 4px;
  padding: 12px 16px;
  max-width: 75%;
  margin-right: auto;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}
```

#### ç³»ç»Ÿæ¶ˆæ¯ï¼ˆå·¥å…·è°ƒç”¨ã€çŠ¶æ€ï¼‰

```css
.system-message {
  background: #edf2f7;
  color: #718096;
  border-radius: 12px;
  padding: 8px 12px;
  font-size: 14px;
  text-align: center;
  margin: 8px auto;
}
```

---

### ç‰¹æ®Šå†…å®¹å¡ç‰‡è®¾è®¡

#### å¤©æ°”å¡ç‰‡

```html
<div class="weather-card">
  <div class="weather-icon">ğŸŒ¤ï¸</div>
  <div class="weather-main">
    <h3>é¦™æ¸¯</h3>
    <div class="temperature">25Â°C</div>
    <div class="condition">å¤šäº‘</div>
  </div>
  <div class="weather-details">
    <div class="detail-item">
      <span class="icon">ğŸŒ¡ï¸</span>
      <span>ä½“æ„Ÿ 27Â°C</span>
    </div>
    <div class="detail-item">
      <span class="icon">ğŸ’§</span>
      <span>æ¹¿åº¦ 69%</span>
    </div>
    <div class="detail-item">
      <span class="icon">ğŸ’¨</span>
      <span>é£é€Ÿ 19km/h</span>
    </div>
  </div>
</div>
```

#### è‚¡ç¥¨å¡ç‰‡

```html
<div class="stock-card">
  <div class="stock-header">
    <h3>è‹¹æœå…¬å¸ (AAPL)</h3>
    <span class="stock-exchange">NASDAQ</span>
  </div>
  <div class="stock-price">
    <span class="price">$272.41</span>
    <span class="change positive">+$3.25 (+1.21%)</span>
  </div>
  <div class="stock-chart">
    [è¿·ä½ èµ°åŠ¿å›¾]
  </div>
  <div class="stock-time">
    æ›´æ–°æ—¶é—´ï¼š2025-11-17 16:00 EST
  </div>
</div>
```

#### çŸ¥è¯†å¡ç‰‡

```html
<div class="knowledge-card">
  <div class="card-header">
    <span class="icon">ğŸ“š</span>
    <h4>å¦‚ä½•ä½¿ç”¨ç²¤è¯­è¾“å…¥</h4>
  </div>
  <div class="card-content">
    <p>ç³»ç»Ÿæ”¯æŒç²¤è¯­STTï¼ˆè¯­éŸ³è½¬æ–‡å­—ï¼‰ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š</p>
    <ul>
      <li>Whisperæ¨¡å‹ï¼šæ”¯æŒå¤šè¯­è¨€è¯†åˆ«</li>
      <li>ä¸“ç”¨ç²¤è¯­Speech APIï¼šæä¾›æ›´é«˜å‡†ç¡®åº¦</li>
      <li>è‡ªåŠ¨è¯­è¨€æ£€æµ‹ï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä½³å¼•æ“</li>
    </ul>
  </div>
  <div class="card-footer">
    <span class="source">æ¥æºï¼šç³»ç»ŸçŸ¥è¯†åº“</span>
  </div>
</div>
```

---

### åŠ¨ç”»æ•ˆæœ

#### 1. æ¶ˆæ¯è¿›å…¥åŠ¨ç”»

```css
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.message {
  animation: slideIn 0.3s ease-out;
}
```

#### 2. æ‰“å­—æ•ˆæœï¼ˆæµå¼è¾“å‡ºï¼‰

```javascript
function typeWriter(text, element, speed = 30) {
  let i = 0;
  element.textContent = '';
  
  const timer = setInterval(() => {
    if (i < text.length) {
      element.textContent += text.charAt(i);
      i++;
    } else {
      clearInterval(timer);
    }
  }, speed);
}
```

#### 3. è¯­éŸ³æ³¢å½¢åŠ¨ç”»

```css
@keyframes pulse {
  0%, 100% { transform: scaleY(1); }
  50% { transform: scaleY(1.5); }
}

.voice-bar {
  width: 4px;
  height: 20px;
  background: #667eea;
  animation: pulse 0.8s ease-in-out infinite;
}

.voice-bar:nth-child(2) { animation-delay: 0.1s; }
.voice-bar:nth-child(3) { animation-delay: 0.2s; }
```

#### 4. åŠ è½½åŠ¨ç”»

```css
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid #667eea;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  animation: spin 1s linear infinite;
}
```

---

## ğŸ”„ äº¤äº’æµç¨‹å›¾

### æ–‡æœ¬æŸ¥è¯¢æµç¨‹

```
ç”¨æˆ·è¾“å…¥æ–‡æœ¬
    â†“
å‰ç«¯å‘é€POST /api/agent_query
    â†“
æ˜¾ç¤º"å¤„ç†ä¸­"çŠ¶æ€
    â†“
åç«¯å¤„ç†
    â”œâ†’ å·¥å…·é€‰æ‹©ï¼ˆè‡ªåŠ¨ï¼‰
    â”œâ†’ æ•°æ®æ£€ç´¢
    â””â†’ ç”Ÿæˆç­”æ¡ˆ
    â†“
æ¥æ”¶å“åº”
    â†“
è§£ætools_used
    â”œâ†’ weather â†’ æ˜¾ç¤ºå¤©æ°”å¡ç‰‡
    â”œâ†’ finance â†’ æ˜¾ç¤ºè‚¡ç¥¨å¡ç‰‡
    â”œâ†’ local_rag â†’ æ˜¾ç¤ºçŸ¥è¯†å¡ç‰‡
    â””â†’ å…¶ä»– â†’ æ˜¾ç¤ºæ–‡æœ¬ç­”æ¡ˆ
    â†“
æ˜¾ç¤ºç­”æ¡ˆï¼ˆå¸¦åŠ¨ç”»ï¼‰
    â†“
æ˜¾ç¤ºå…ƒä¿¡æ¯ï¼ˆå·¥å…·ã€æ—¶é—´ï¼‰
```

### è¯­éŸ³æŸ¥è¯¢æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»è¯­éŸ³æŒ‰é’®
    â†“
è¯·æ±‚éº¦å…‹é£æƒé™
    â†“
å»ºç«‹WebSocketè¿æ¥
    â†“
æ˜¾ç¤º"æ­£åœ¨å¬..."çŠ¶æ€
    â†“
å¼€å§‹å½•éŸ³
    â”œâ†’ æ•è·éŸ³é¢‘æµ
    â”œâ†’ å®æ—¶å‘é€åˆ°æœåŠ¡å™¨
    â””â†’ æ˜¾ç¤ºéŸ³æ³¢åŠ¨ç”»
    â†“
ç”¨æˆ·åœæ­¢å½•éŸ³ æˆ– æ£€æµ‹åˆ°é™éŸ³
    â†“
æ˜¾ç¤º"å¤„ç†ä¸­"çŠ¶æ€
    â†“
æ¥æ”¶è½¬å½•ç»“æœ
    â†“
æ˜¾ç¤ºè½¬å½•æ–‡æœ¬
    â†“
æ¥æ”¶ç­”æ¡ˆ
    â†“
æ˜¾ç¤ºæ–‡æœ¬ç­”æ¡ˆ
    â†“
æ¥æ”¶éŸ³é¢‘å›å¤
    â†“
æ’­æ”¾TTSéŸ³é¢‘
    â†“
å®Œæˆ
```

### æ–‡ä»¶ä¸Šä¼ æµç¨‹

```
ç”¨æˆ·é€‰æ‹©æ–‡ä»¶
    â†“
å‰ç«¯éªŒè¯
    â”œâ†’ æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ<50MBï¼‰
    â”œâ†’ æ£€æŸ¥æ–‡ä»¶ç±»å‹
    â””â†’ é¢„è§ˆç¼©ç•¥å›¾
    â†“
æ˜¾ç¤ºä¸Šä¼ è¿›åº¦æ¡
    â†“
POST /api/upload
    â†“
æ¥æ”¶file_id
    â†“
æ˜¾ç¤º"å¤„ç†ä¸­"æç¤º
    â†“
è½®è¯¢æ–‡ä»¶çŠ¶æ€
GET /api/files/{file_id}
    â†“
processed = true
    â†“
æ˜¾ç¤º"ä¸Šä¼ æˆåŠŸ"
    â†“
æ›´æ–°æ–‡ä»¶åˆ—è¡¨
```

---

## âš ï¸ é”™è¯¯å¤„ç†

### é”™è¯¯ç±»å‹å’Œå¤„ç†ç­–ç•¥

#### 1. ç½‘ç»œé”™è¯¯

```javascript
try {
  const response = await fetch('/api/agent_query', options);
} catch (error) {
  if (error instanceof TypeError) {
    showError('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®');
  } else {
    showError('è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
  }
}
```

**UIæ˜¾ç¤º**:
```
âš ï¸ ç½‘ç»œè¿æ¥å¤±è´¥
è¯·æ£€æŸ¥ä½ çš„ç½‘ç»œè®¾ç½®åé‡è¯•

[é‡è¯•] [å–æ¶ˆ]
```

#### 2. APIé”™è¯¯

```javascript
if (!response.ok) {
  const error = await response.json();
  
  switch (response.status) {
    case 400:
      showError('è¯·æ±‚æ ¼å¼é”™è¯¯ï¼š' + error.detail);
      break;
    case 429:
      showError('è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•');
      break;
    case 500:
      showError('æœåŠ¡å™¨é”™è¯¯ï¼Œæˆ‘ä»¬æ­£åœ¨ä¿®å¤ä¸­...');
      break;
    default:
      showError('æœªçŸ¥é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜');
  }
}
```

#### 3. è¶…æ—¶é”™è¯¯

```javascript
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 30000);

try {
  const response = await fetch('/api/agent_query', {
    signal: controller.signal,
    ...options
  });
} catch (error) {
  if (error.name === 'AbortError') {
    showError('è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•');
  }
} finally {
  clearTimeout(timeoutId);
}
```

#### 4. è¯­éŸ³ç›¸å…³é”™è¯¯

```javascript
// éº¦å…‹é£æƒé™è¢«æ‹’ç»
navigator.mediaDevices.getUserMedia({ audio: true })
  .catch(error => {
    if (error.name === 'NotAllowedError') {
      showError('éœ€è¦éº¦å…‹é£æƒé™æ‰èƒ½ä½¿ç”¨è¯­éŸ³åŠŸèƒ½');
    } else if (error.name === 'NotFoundError') {
      showError('æœªæ£€æµ‹åˆ°éº¦å…‹é£è®¾å¤‡');
    }
  });
```

### é”™è¯¯æ¶ˆæ¯æ˜¾ç¤ºè§„èŒƒ

```typescript
interface ErrorMessage {
  type: 'error' | 'warning' | 'info';
  title: string;
  message: string;
  actions?: {
    label: string;
    handler: () => void;
  }[];
}

// ç¤ºä¾‹
const errorMsg: ErrorMessage = {
  type: 'error',
  title: 'ç½‘ç»œé”™è¯¯',
  message: 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®',
  actions: [
    { label: 'é‡è¯•', handler: () => retryRequest() },
    { label: 'å–æ¶ˆ', handler: () => closeError() }
  ]
};
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å‰ç«¯ä¼˜åŒ–

#### é˜²æŠ–å’ŒèŠ‚æµ

```javascript
// è¾“å…¥é˜²æŠ–ï¼ˆç”¨äºæœç´¢å»ºè®®ï¼‰
const debouncedSearch = debounce((query) => {
  fetchSuggestions(query);
}, 300);

// æ»šåŠ¨èŠ‚æµï¼ˆç”¨äºæ— é™æ»šåŠ¨ï¼‰
const throttledScroll = throttle(() => {
  loadMoreMessages();
}, 1000);
```

#### æ¶ˆæ¯è™šæ‹ŸåŒ–

```javascript
// ä»…æ¸²æŸ“å¯è§æ¶ˆæ¯ï¼Œæå‡é•¿å¯¹è¯æ€§èƒ½
import { VirtualList } from 'react-virtual';

<VirtualList
  height={600}
  itemCount={messages.length}
  itemSize={100}
  renderItem={({ index }) => <Message data={messages[index]} />}
/>
```

#### æ‡’åŠ è½½

```javascript
// æ‡’åŠ è½½å†å²æ¶ˆæ¯
const loadHistoryMessages = async () => {
  if (hasMore && !loading) {
    setLoading(true);
    const oldMessages = await fetchMessages(offset);
    setMessages(prev => [...oldMessages, ...prev]);
    setLoading(false);
  }
};
```

### 2. è¯·æ±‚ä¼˜åŒ–

#### ç¼“å­˜ç­–ç•¥

```javascript
// ç¼“å­˜å¸¸è§æŸ¥è¯¢ç»“æœ
const cache = new Map();

async function queryWithCache(query) {
  const cacheKey = query.toLowerCase();
  
  if (cache.has(cacheKey)) {
    const cached = cache.get(cacheKey);
    if (Date.now() - cached.timestamp < 3600000) { // 1å°æ—¶
      return cached.data;
    }
  }
  
  const data = await fetchQuery(query);
  cache.set(cacheKey, { data, timestamp: Date.now() });
  return data;
}
```

#### è¯·æ±‚å–æ¶ˆ

```javascript
let currentRequest = null;

async function searchQuery(query) {
  // å–æ¶ˆä¸Šä¸€ä¸ªæœªå®Œæˆçš„è¯·æ±‚
  if (currentRequest) {
    currentRequest.abort();
  }
  
  currentRequest = new AbortController();
  
  try {
    const response = await fetch('/api/agent_query', {
      signal: currentRequest.signal,
      method: 'POST',
      body: JSON.stringify({ query })
    });
    return await response.json();
  } catch (error) {
    if (error.name !== 'AbortError') {
      throw error;
    }
  }
}
```

### 3. WebSocketä¼˜åŒ–

#### å¿ƒè·³æœºåˆ¶

```javascript
const ws = new WebSocket('ws://localhost:8000/ws/voice');
let heartbeatInterval;

ws.onopen = () => {
  // æ¯30ç§’å‘é€å¿ƒè·³
  heartbeatInterval = setInterval(() => {
    ws.send(JSON.stringify({ type: 'ping' }));
  }, 30000);
};

ws.onclose = () => {
  clearInterval(heartbeatInterval);
};
```

#### è‡ªåŠ¨é‡è¿

```javascript
function connectWebSocket(maxRetries = 5) {
  let retries = 0;
  
  function connect() {
    const ws = new WebSocket('ws://localhost:8000/ws/voice');
    
    ws.onclose = () => {
      if (retries < maxRetries) {
        retries++;
        setTimeout(connect, 1000 * retries); // æŒ‡æ•°é€€é¿
      }
    };
    
    ws.onerror = () => {
      ws.close();
    };
    
    return ws;
  }
  
  return connect();
}
```

---

## ğŸ“± å“åº”å¼è®¾è®¡

### æ–­ç‚¹å®šä¹‰

```css
/* ç§»åŠ¨ç«¯ */
@media (max-width: 768px) {
  .chat-container {
    padding: 12px;
  }
  
  .message {
    max-width: 85%;
    font-size: 15px;
  }
  
  .input-area {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
  }
}

/* å¹³æ¿ */
@media (min-width: 769px) and (max-width: 1024px) {
  .chat-container {
    max-width: 768px;
    margin: 0 auto;
  }
}

/* æ¡Œé¢ */
@media (min-width: 1025px) {
  .chat-container {
    max-width: 1024px;
    margin: 0 auto;
  }
  
  .sidebar {
    display: block; /* æ˜¾ç¤ºä¾§è¾¹æ  */
  }
}
```

### ç§»åŠ¨ç«¯ä¼˜åŒ–

```javascript
// æ£€æµ‹ç§»åŠ¨è®¾å¤‡
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

if (isMobile) {
  // å¯ç”¨è§¦æ‘¸ä¼˜åŒ–
  enableTouchGestures();
  
  // ä¼˜åŒ–è¯­éŸ³æŒ‰é’®å¤§å°
  voiceButton.style.minHeight = '48px';
  voiceButton.style.minWidth = '48px';
  
  // é˜²æ­¢è¾“å…¥æ¡†ç¼©æ”¾
  inputField.style.fontSize = '16px';
}
```

---

## ğŸ¯ æ¨èæŠ€æœ¯æ ˆ

### å‰ç«¯æ¡†æ¶

**é€‰é¡¹1: React + TypeScriptï¼ˆæ¨èï¼‰**
```bash
npm create vite@latest minimango-frontend -- --template react-ts
```

**é€‰é¡¹2: Vue 3 + TypeScript**
```bash
npm create vite@latest minimango-frontend -- --template vue-ts
```

### å…³é”®åº“

```json
{
  "dependencies": {
    "axios": "^1.6.0",           // HTTPè¯·æ±‚
    "socket.io-client": "^4.5.0", // WebSocket
    "react-markdown": "^9.0.0",   // Markdownæ¸²æŸ“
    "framer-motion": "^10.0.0",   // åŠ¨ç”»
    "recharts": "^2.10.0",        // å›¾è¡¨ï¼ˆè‚¡ç¥¨èµ°åŠ¿ï¼‰
    "@heroicons/react": "^2.0.0", // å›¾æ ‡
    "date-fns": "^2.30.0"         // æ—¥æœŸå¤„ç†
  }
}
```

---

## ğŸ“ å®Œæ•´ä»£ç ç¤ºä¾‹

### Reactç»„ä»¶ç¤ºä¾‹

```typescript
// ChatInterface.tsx
import { useState, useEffect, useRef } from 'react';
import axios from 'axios';

interface Message {
  id: string;
  type: 'user' | 'assistant' | 'system';
  content: string;
  timestamp: Date;
  metadata?: {
    tools_used?: string[];
    response_time?: number;
  };
}

export function ChatInterface() {
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState('');
  const [loading, setLoading] = useState(false);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  const sendMessage = async () => {
    if (!input.trim()) return;

    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    const userMessage: Message = {
      id: Date.now().toString(),
      type: 'user',
      content: input,
      timestamp: new Date()
    };
    setMessages(prev => [...prev, userMessage]);
    setInput('');
    setLoading(true);

    try {
      // è°ƒç”¨API
      const response = await axios.post('http://localhost:8000/api/agent_query', {
        query: input
      });

      // æ·»åŠ åŠ©æ‰‹å›å¤
      const assistantMessage: Message = {
        id: (Date.now() + 1).toString(),
        type: 'assistant',
        content: response.data.answer,
        timestamp: new Date(),
        metadata: {
          tools_used: response.data.tools_used,
          response_time: response.data.response_time
        }
      };
      setMessages(prev => [...prev, assistantMessage]);
    } catch (error) {
      console.error('Error:', error);
      // æ·»åŠ é”™è¯¯æ¶ˆæ¯
      const errorMessage: Message = {
        id: (Date.now() + 1).toString(),
        type: 'system',
        content: 'æŠ±æ­‰ï¼Œå‘ç”Ÿäº†é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚',
        timestamp: new Date()
      };
      setMessages(prev => [...prev, errorMessage]);
    } finally {
      setLoading(false);
    }
  };

  // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  return (
    <div className="chat-interface">
      <div className="messages-container">
        {messages.map(msg => (
          <div key={msg.id} className={`message ${msg.type}`}>
            <div className="message-content">{msg.content}</div>
            {msg.metadata && (
              <div className="message-metadata">
                {msg.metadata.tools_used && (
                  <span>ğŸ”§ {msg.metadata.tools_used.join(', ')}</span>
                )}
                {msg.metadata.response_time && (
                  <span>â±ï¸ {msg.metadata.response_time.toFixed(2)}s</span>
                )}
              </div>
            )}
          </div>
        ))}
        {loading && (
          <div className="message assistant loading">
            <div className="loading-spinner" />
            æ­£åœ¨æ€è€ƒ...
          </div>
        )}
        <div ref={messagesEndRef} />
      </div>

      <div className="input-area">
        <input
          type="text"
          value={input}
          onChange={(e) => setInput(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
          placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."
          disabled={loading}
        />
        <button onClick={sendMessage} disabled={loading || !input.trim()}>
          å‘é€
        </button>
      </div>
    </div>
  );
}
```

---

## ğŸ¨ æ ·å¼å‚è€ƒ

```css
/* styles.css */
:root {
  --primary-color: #667eea;
  --secondary-color: #764ba2;
  --background: #ffffff;
  --surface: #f7f9fc;
  --text-primary: #2d3748;
  --text-secondary: #718096;
  --border-radius: 18px;
  --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.chat-interface {
  display: flex;
  flex-direction: column;
  height: 100vh;
  max-width: 800px;
  margin: 0 auto;
  background: var(--background);
}

.messages-container {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.message {
  padding: 12px 16px;
  border-radius: var(--border-radius);
  max-width: 70%;
  word-wrap: break-word;
  box-shadow: var(--shadow);
}

.message.user {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  color: white;
  margin-left: auto;
  border-radius: 18px 18px 4px 18px;
}

.message.assistant {
  background: var(--surface);
  color: var(--text-primary);
  margin-right: auto;
  border-radius: 18px 18px 18px 4px;
}

.message.system {
  background: #edf2f7;
  color: var(--text-secondary);
  font-size: 14px;
  text-align: center;
  margin: 8px auto;
  max-width: 80%;
}

.message-metadata {
  margin-top: 8px;
  font-size: 12px;
  color: var(--text-secondary);
  display: flex;
  gap: 12px;
}

.input-area {
  display: flex;
  padding: 16px;
  background: var(--surface);
  border-top: 1px solid #e2e8f0;
  gap: 12px;
}

.input-area input {
  flex: 1;
  padding: 12px 16px;
  border: 1px solid #e2e8f0;
  border-radius: 24px;
  font-size: 16px;
  outline: none;
  transition: border-color 0.3s;
}

.input-area input:focus {
  border-color: var(--primary-color);
}

.input-area button {
  padding: 12px 24px;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  color: white;
  border: none;
  border-radius: 24px;
  font-size: 16px;
  cursor: pointer;
  transition: transform 0.2s;
}

.input-area button:hover {
  transform: translateY(-2px);
}

.input-area button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.loading-spinner {
  width: 20px;
  height: 20px;
  border: 3px solid #f3f3f3;
  border-top: 3px solid var(--primary-color);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  display: inline-block;
  margin-right: 8px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰å‰ç«¯é›†æˆé—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ `/docs` ä¸‹çš„æŠ€æœ¯æ–‡æ¡£
2. è®¿é—® API Swaggeræ–‡æ¡£ï¼š`http://localhost:8000/docs`
3. åˆ›å»ºGitHub Issue
4. è”ç³»é¡¹ç›®ç»´æŠ¤è€…

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025-11-17  
**ç»´æŠ¤è€…**: Team MiniMango  
**é¡¹ç›®åœ°å€**: https://github.com/AnonymityHE/MAIE-5221-NLP-Final-Intelligent-Search-Engine


